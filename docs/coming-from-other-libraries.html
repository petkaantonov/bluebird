<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
 <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,200,700,500,100,800,600,900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
    <title>Coming from Other Libraries | bluebird</title>
    <meta name="description" content="Bluebird is a fully featured JavaScript promises library with unmatched performance.">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/mono-blue.css" type='text/css' />
    <link rel="stylesheet" href="/css/hover-min.css" media="all">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://bluebirdjs.com/docs/coming-from-other-libraries.html">
    <link rel="icon" href="/img/favicon.png" type="image/png" />
  </head>

  <body>

    <nav class="navbar" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a href="/bluebird" class="title">
                    <img src="/img/logo.png" class="hidden-xs" />

                    <span class="tagline">bluebird</span>
                </a>
            </div>
            <div id="navbar" class="navbar-collapse navbar-bluebird navbar-right collapse">
                <ul class="nav navbar-nav bb-nav">
                    
                        
                    

                    <li class="active"><a href="/docs/getting-started.html">Docs</a></li>
                    <li class=""><a href="/docs/support.html">Support</a></li>
                    <li class=""><a href="/docs/install.html">Install</a></li>
                    <li><a href="https://github.com/petkaantonov/bluebird/">Github</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>

   <div class="container">
      <div class="row">
        <div class="col-sm-3">
            <ul class="nav left-nav">
                <li><a href="/docs/getting-started.html">Getting Started</a></li>
                <li><a href="/docs/features.html">Features</a></li>
                <li><a href="/docs/changelog.html">Changelog</a></li>
                <li><a href="/docs/api-reference.html"><strong>API Reference</strong></a></li>
                <li><a href="/docs/new-in-bluebird-3.html"><strong>New in 3.0</strong></a></li>
                <li><a href="/docs/warning-explanations.html">Warning Explanations</a></li>
                <li><a href="/docs/error-explanations.html">Error Explanations</a></li>
                <li><a href="/docs/contribute.html">Contribute</a></li>
                <li><a href="/docs/benchmarks.html">Benchmarks</a></li>
                <li><a href="/docs/deprecated-apis.html">Deprecated APIs</a></li>
                <li><hr></li>
                <li>Why?
                    <ul class="nav nav-child">
                        <li><a href="/docs/why-promises.html">Why Promises?</a></li>
                        <li><a href="/docs/why-bluebird.html">Why bluebird?</a></li>
                        <li><a href="/docs/why-performance.html">Why Performance?</a></li>
                        <li><a href="/docs/what-about-generators.html">What About Generators?</a></li>
                    </ul>
                </li>
                <li><hr></li>
                <li>
                    Tutorials
                    <ul class="nav nav-child">
                        <li><a href="/docs/async-dialogs.html">Async Dialogs</a></li>
                    </ul>
                </li>
                <li><hr></li>
                <li>
                    Guides
                    <ul class="nav nav-child">
                        <li><a href="/docs/beginners-guide.html">Beginner's Guide</a></li>
                        <li><a href="/docs/anti-patterns.html">Anti-patterns</a></li>
                        <li><a href="/docs/working-with-callbacks.html">Working with Callbacks</a></li>
                        <li><a href="/docs/coming-from-other-languages.html">Coming from Other Languages</a></li>
                        <li><a href="/docs/coming-from-other-libraries.html">Coming from Other Libraries</a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <div class="col-sm-9">
            
            <div class="post-info">
                <a href="https://github.com/petkaantonov/bluebird/edit/master/docs/docs/coming-from-other-libraries.md">
                    <i class="fa fa-edit"></i>
                    Edit on Github</a>
                <br>
                <i>Updated 27 Oct 2015</i>
            </div>
            <div class="clearfix"></div>
            
            <div class="post">

  <header class="post-header">
    <h1 class="post-title">Coming from Other Libraries</h1>
  </header>

  <article class="post-content">
    <p>This page is a reference for migrating to bluebird from other flow control or promise libraries. See <a href='install.html' title=''>installation</a> on how to use bluebird in your environment.</p>

<ul>
<li><a href='#coming-from-native-promises' title=''>Coming from native promises</a></li>
<li><a href='#coming-from-jquery-deferreds' title=''>Coming from jQuery deferreds</a></li>
<li><a href='#coming-from-async-module' title=''>Coming from <code>async</code> module</a></li>
<li><a href='#coming-from-q' title=''>Coming from Q</a></li>
<li><a href='#coming-from-co' title=''>Coming from co/koa</a></li>
<li><a href='#coming-from-highland' title=''>Coming from highland, RxJS or BaconJS</a></li>
</ul>
            <h2>
                <a class="header-anchor"
                    name="coming-from-native-promises"
                    aria-hidden="true"
                    href="#coming-from-native-promises"><i class="fa fa-link"></i></a>
                Coming from native promises
            </h2>

<p>Bluebird promises are a drop-in replacement for native promises except for subclassing. Additionally you might want to replace usages of the often incorrectly used <a href='/docs/api/promise.race.html'><code>Promise.race</code></a> with bluebird&#39;s <a href='/docs/api/promise.any.html'><code>Promise.any</code></a> which does what is usually mistakenly expected from <a href='/docs/api/promise.race.html'><code>Promise.race</code></a>. For maximum compatibility, bluebird does provide <a href='/docs/api/promise.race.html'><code>Promise.race</code></a> with ES6 semantics.</p>

<p>You can also refactor some looping patterns to a more natural form that would <a href='https://github.com/promises-aplus/promises-spec/issues/179' title=''>leak memory when using native promises</a>.</p>
            <h2>
                <a class="header-anchor"
                    name="coming-from-jquery-deferreds"
                    aria-hidden="true"
                    href="#coming-from-jquery-deferreds"><i class="fa fa-link"></i></a>
                Coming from jQuery deferreds
            </h2>

<p>Bluebird treats jQuery deferreds and promises interchangeably. Wherever you can take a promise or return a promise, you can take or return a jQuery deferred instead and it works the same.</p>

<p>For instance, there is no need to write something like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">firstRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({...}).</span><span class="nx">done</span><span class="p">(</span><span class="nx">resolve</span><span class="p">).</span><span class="nx">fail</span><span class="p">(</span><span class="nx">reject</span><span class="p">);</span>
<span class="p">});</span>
<span class="kd">var</span> <span class="nx">secondRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({...}).</span><span class="nx">done</span><span class="p">(</span><span class="nx">resolve</span><span class="p">).</span><span class="nx">fail</span><span class="p">(</span><span class="nx">reject</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">firstRequest</span><span class="p">,</span> <span class="nx">secondRequest</span><span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div>
<p>Since <a href='/docs/api/promise.all.html'><code>Promise.all</code></a> takes promises, it must also take jQuery deferreds, so the above can be shortened to:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">firstRequest</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({...});</span>
<span class="kd">var</span> <span class="nx">secondRequest</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({...});</span>

<span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">firstRequest</span><span class="p">,</span> <span class="nx">secondRequest</span><span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div>
<p>That said, if you have code written using jQuery deferred methods, such as <code>.then</code>, <code>.done</code> and so on, you cannot drop-in replace the jQuery deferred with a bluebird promise in that code. Despite having the same names, jQuery deferred methods have different semantics than bluebird promise methods. These differences are due to the completely different goals of the implementations. Bluebird is <a href='http://en.wikipedia.org/wiki/Domain-specific_language' title=''>an internal DSL</a> for the domain of asynchronous control flow while jQuery deferreds are a callback aggregator utility (&quot;glorified event emitters&quot;).</p>

<p>If you do have some code using jQuery deferred methods extensively try to see if some of these jQuery deferred patterns and their replacements can be applied:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// jQuery</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">someArray</span><span class="p">).</span><span class="nx">then</span><span class="p">(...)</span>
<span class="c1">// bluebird</span>
<span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">someArray</span><span class="p">).</span><span class="nx">then</span><span class="p">(...)</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// jQuery</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">processItemsDeferred</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">processItemsDeferred</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">processItem</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
<span class="p">}</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">processItemsDeferred</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">everythingDone</span><span class="p">);</span>

<span class="c1">// bluebird</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">];</span>
<span class="nx">Promise</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">processItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">everythingDone</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// jQuery</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">);</span>
<span class="c1">// bluebird</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// jQuery</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">));</span>
<span class="c1">// bluebird</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">));</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// jQuery</span>
<span class="kd">var</span> <span class="nx">clicked</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">one</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">clicked</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// bluebird</span>
<span class="kd">var</span> <span class="nx">clicked</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">one</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// jQuery</span>
<span class="p">.</span><span class="nx">always</span><span class="p">(</span><span class="nx">removeSpinner</span><span class="p">);</span>
<span class="c1">// bluebird</span>
<span class="p">.</span><span class="k">finally</span><span class="p">(</span><span class="nx">removeSpinner</span><span class="p">);</span>
</code></pre></div>            <h2>
                <a class="header-anchor"
                    name="coming-from-async-module"
                    aria-hidden="true"
                    href="#coming-from-async-module"><i class="fa fa-link"></i></a>
                Coming from <code>async</code> module
            </h2>

<p>When working with promises the philosophy is basically a complete opposite than when using <code>async</code>. Async provides a huge bag of uncomposable helper functions that work at a very low level of abstraction. When using promises you can get the utility otherwise provided by uncountable amount of inflexible helper functions by just combining and composing a few existing functions and concepts.</p>

<p>That means when you have a problem there probably isn&#39;t an existing function tailored exactly to that problem but instead you can just combine the existing utilities to arrive at a solution. The upside of this is that you don&#39;t need to come up with all these different functions to solve problems that are not that different from each other. The most important thing to do when migrating from async to bluebird is this profound shift in philosophy.</p>

<p>This section lists the most common async module replacements.</p>
            <h3>
                <a class="header-anchor"
                    name="async.waterfall"
                    aria-hidden="true"
                    href="#async.waterfall"><i class="fa fa-link"></i></a>
                <code>async.waterfall</code>
            </h3>

<p>If the waterfall elements are static, you can just replace it with a normal promise chain. For waterfalls with dynamic steps, use <a href='/docs/api/promise.each.html'><code>Promise.each</code></a>. Multiple arguments can be ferried in an array.</p>

<p>Implementing the example from <a href='https://github.com/caolan/async#waterfalltasks-callback' title=''>async homepage</a></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">async</span><span class="p">.</span><span class="nx">waterfall</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// arg1 now equals &#39;one&#39; and arg2 now equals &#39;two&#39;</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// arg1 now equals &#39;three&#39;</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;done&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result now equals &#39;done&#39;</span>
<span class="p">});</span>
</code></pre></div>
<p>Since the array passed to waterfall is static (always the same 3 functions) a plain old promise chain is used:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]).</span><span class="nx">spread</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// arg1 now equals &#39;one&#39; and arg2 now equals &#39;two&#39;</span>
    <span class="k">return</span> <span class="s1">&#39;three&#39;</span><span class="p">;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// arg1 now equals &#39;three&#39;</span>
    <span class="k">return</span> <span class="s1">&#39;done&#39;</span><span class="p">;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result now equals &#39;done&#39;</span>
<span class="p">});</span>
</code></pre></div>
<p>If destructuring parameters are supported, <code>.spread(function(arg1, arg2) {})</code> can be replaced with <code>.then(function([arg1, arg2]){})</code>.</p>
            <h3>
                <a class="header-anchor"
                    name="async.series"
                    aria-hidden="true"
                    href="#async.series"><i class="fa fa-link"></i></a>
                <code>async.series</code>
            </h3>

<p>Using <a href='/docs/api/promise.each.html'><code>Promise.each</code></a> to implement the example from <a href='https://github.com/caolan/async#seriestasks-callback' title=''>async homepage</a>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">async</span><span class="p">.</span><span class="nx">series</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">],</span>
<span class="c1">// optional callback</span>
<span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
    <span class="c1">// results is now equal to [1, 2]</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Promise</span><span class="p">.</span><span class="nx">each</span><span class="p">([{</span><span class="nx">timeout</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span><span class="p">},</span>
              <span class="p">{</span><span class="nx">timeout</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mi">2</span><span class="p">}],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">timeout</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// results is now equal to [1, 2]</span>
<span class="p">});</span>
</code></pre></div>            <h3>
                <a class="header-anchor"
                    name="async.parallel"
                    aria-hidden="true"
                    href="#async.parallel"><i class="fa fa-link"></i></a>
                <code>async.parallel</code>
            </h3>

<p>Using <a href='/docs/api/promise.all.html'><code>Promise.all</code></a> to implement the example from <a href='https://github.com/caolan/async#parallel' title=''>async homepage</a>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">async</span><span class="p">.</span><span class="nx">parallel</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">],</span>
<span class="c1">// optional callback</span>
<span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
    <span class="c1">// the results array will equal [&#39;one&#39;,&#39;two&#39;] even though</span>
    <span class="c1">// the second function had a shorter timeout.</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">Promise</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
             <span class="nx">Promise</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// the results array will equal [&#39;one&#39;,&#39;two&#39;] even though</span>
    <span class="c1">// the second function had a shorter timeout.</span>
<span class="p">});</span>
</code></pre></div>            <h3>
                <a class="header-anchor"
                    name="async.mapseries"
                    aria-hidden="true"
                    href="#async.mapseries"><i class="fa fa-link"></i></a>
                <code>async.mapSeries</code>
            </h3>

<p>Using <a href='/docs/api/promise.each.html'><code>Promise.each</code></a> to implement the example from <a href='https://github.com/caolan/async#maparr-iterator-callback' title=''>async homepage</a>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="nx">async</span><span class="p">.</span><span class="nx">mapSeries</span><span class="p">([</span><span class="s1">&#39;file1&#39;</span><span class="p">,</span><span class="s1">&#39;file2&#39;</span><span class="p">,</span><span class="s1">&#39;file3&#39;</span><span class="p">],</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
    <span class="c1">// results is now an array of stats for each file</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">));</span>
<span class="nx">Promise</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s1">&#39;file1&#39;</span><span class="p">,</span><span class="s1">&#39;file2&#39;</span><span class="p">,</span><span class="s1">&#39;file3&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fileName</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">statAsync</span><span class="p">(</span><span class="nx">fileName</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// results is now an array of stats for each file</span>
<span class="p">});</span>
</code></pre></div>            <h3>
                <a class="header-anchor"
                    name="async.map"
                    aria-hidden="true"
                    href="#async.map"><i class="fa fa-link"></i></a>
                <code>async.map</code>
            </h3>

<p>Using <a href='/docs/api/promise.map.html'><code>Promise.map</code></a> to implement the example from <a href='https://github.com/caolan/async#maparr-iterator-callback' title=''>async homepage</a>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="nx">async</span><span class="p">.</span><span class="nx">map</span><span class="p">([</span><span class="s1">&#39;file1&#39;</span><span class="p">,</span><span class="s1">&#39;file2&#39;</span><span class="p">,</span><span class="s1">&#39;file3&#39;</span><span class="p">],</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
    <span class="c1">// results is now an array of stats for each file</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">var fs = Promise.promisifyAll(require(&#39;fs&#39;));
Promise.map([&#39;file1&#39;,&#39;file2&#39;,&#39;file3&#39;], function(fileName, index, length) {
    return fs.statAsync(fileName);
}).then(function(results) {
    // results is now an array of stats for each file
});
</code></pre></div>            <h3>
                <a class="header-anchor"
                    name="async.whilst"
                    aria-hidden="true"
                    href="#async.whilst"><i class="fa fa-link"></i></a>
                <code>async.whilst</code>
            </h3>

<p>Using recursion to implement the example from <a href='https://github.com/caolan/async#whilsttest-fn-callback' title=''>async homepage</a>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">async</span><span class="p">.</span><span class="nx">whilst</span><span class="p">(</span>
    <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 5 seconds have passed</span>
    <span class="p">}</span>
<span class="p">);</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span> <span class="nx">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">loop</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
<span class="p">})().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 5 seconds have passed</span>
<span class="p">});</span>
</code></pre></div>
<p>Be warned that the above example implementations are only superficially equivalent. Callbacks, even with the help of async, require too much boilerplate code to provide the same guarantees as promises.</p>
            <h2>
                <a class="header-anchor"
                    name="coming-from-q"
                    aria-hidden="true"
                    href="#coming-from-q"><i class="fa fa-link"></i></a>
                Coming from Q
            </h2>

<p>Q and bluebird share a lot of common methods that nevertheless have different names:</p>

<ul>
<li><code>Q(...)</code> -&gt; <a href='/docs/api/promise.resolve.html'><code>Promise.resolve()</code></a></li>
<li><code>.fail()</code> -&gt; <a href='/docs/api/catch.html'><code>.catch()</code></a> or <code>.caught()</code></li>
<li><code>.fin()</code> -&gt; <a href='/docs/api/finally.html'><code>.finally()</code></a> or <code>.lastly()</code></li>
<li><code>Q.fcall()</code> -&gt; <a href='/docs/api/promise.try.html'><code>Promise.try</code></a> or <code>Promise.attempt()</code></li>
<li><code>.thenResolve()</code> -&gt; <a href='/docs/api/return.html'><code>.return()</code></a> or <code>.thenReturn()</code></li>
<li><code>.thenReject()</code> -&gt; <a href='/docs/api/throw.html'><code>.throw()</code></a> or <code>thenThrow()</code></li>
</ul>
            <h2>
                <a class="header-anchor"
                    name="coming-from-co"
                    aria-hidden="true"
                    href="#coming-from-co"><i class="fa fa-link"></i></a>
                Coming from co/koa
            </h2>

<p>In recent versions generator libraries started abandoning old ideas of special tokens passed to callbacks and started using promises for what&#39;s being yielded.</p>

<p>Bluebird&#39;s <a href='/docs/api/promise.coroutine.html'><code>Promise.coroutine</code></a> is a superset of the <code>co</code> library, being more extensible as well as supporting cancellation (in environments where <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/return' title=''><code>Generator#return</code></a> is implemented).</p>
            <h2>
                <a class="header-anchor"
                    name="coming-from-highland"
                    aria-hidden="true"
                    href="#coming-from-highland"><i class="fa fa-link"></i></a>
                Coming from highland, RxJS or BaconJS
            </h2>

<p>Stream libraries tend to serve a different purpose than promise libraries. Unlike promise libraries streams can represent multiple values.</p>

<p>Check out the benchmarks section for examples of transitioning an API from Bacon/Rx to promises.</p>

  </article>

</div>

        </div>
      </div>
    </div>
    <footer></footer>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
</body>

</html>
