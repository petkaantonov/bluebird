<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
 <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,200,700,500,100,800,600,900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
    <title>Promise.promisifyAll | bluebird</title>
    <meta name="description" content="Bluebird is a fully featured JavaScript promises library with unmatched performance.">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/mono-blue.css" type='text/css' />
    <link rel="stylesheet" href="/css/hover-min.css" media="all">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://bluebirdjs.com/docs/api/promise.promisifyall.html">
    <link rel="icon" href="/img/favicon.png" type="image/png" />
  </head>

  <body>

    <nav class="navbar" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a href="/" class="title">
                    <img src="/img/logo.png" class="hidden-xs" />

                    <span class="tagline">bluebird</span>
                </a>
            </div>
            <div id="navbar" class="navbar-collapse navbar-bluebird navbar-right collapse">
                <ul class="nav navbar-nav bb-nav">
                    
                        
                    

                    <li class="active"><a href="/docs/getting-started.html">Docs</a></li>
                    <li class=""><a href="/docs/support.html">Support</a></li>
                    <li class=""><a href="/docs/install.html">Install</a></li>
                    <li><a href="https://github.com/petkaantonov/bluebird/">Github</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>

   <div class="container">
      <div class="row">
        <div class="col-sm-3">
            <ul class="nav left-nav">
                <li><a href="/docs/getting-started.html">Getting Started</a></li>
                <li><a href="/docs/features.html">Features</a></li>
                <li><a href="/docs/changelog.html">Changelog</a></li>
                <li><a href="/docs/api-reference.html"><strong>API Reference</strong></a></li>
                <li><a href="/docs/new-in-bluebird-3.html"><strong>New in 3.0</strong></a></li>
                <li><a href="/docs/warning-explanations.html">Warning Explanations</a></li>
                <li><a href="/docs/error-explanations.html">Error Explanations</a></li>
                <li><a href="/docs/contribute.html">Contribute</a></li>
                <li><a href="/docs/benchmarks.html">Benchmarks</a></li>
                <li><a href="/docs/deprecated-apis.html">Deprecated APIs</a></li>
                <li><hr></li>
                <li>Why?
                    <ul class="nav nav-child">
                        <li><a href="/docs/why-promises.html">Why Promises?</a></li>
                        <li><a href="/docs/why-bluebird.html">Why bluebird?</a></li>
                        <li><a href="/docs/why-performance.html">Why Performance?</a></li>
                        <li><a href="/docs/what-about-generators.html">What About Generators?</a></li>
                    </ul>
                </li>
                <li><hr></li>
                <li>
                    Tutorials
                    <ul class="nav nav-child">
                        <li><a href="/docs/async-dialogs.html">Async Dialogs</a></li>
                    </ul>
                </li>
                <li><hr></li>
                <li>
                    Guides
                    <ul class="nav nav-child">
                        <li><a href="/docs/beginners-guide.html">Beginner's Guide</a></li>
                        <li><a href="/docs/anti-patterns.html">Anti-patterns</a></li>
                        <li><a href="/docs/working-with-callbacks.html">Working with Callbacks</a></li>
                        <li><a href="/docs/coming-from-other-languages.html">Coming from Other Languages</a></li>
                        <li><a href="/docs/coming-from-other-libraries.html">Coming from Other Libraries</a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <div class="col-sm-9">
            
            <div class="post-info">
                <a href="https://github.com/petkaantonov/bluebird/edit/master/docs/docs/api/promise.promisifyall.md">
                    <i class="fa fa-edit"></i>
                    Edit on Github</a>
                <br>
                <i>Updated 27 Oct 2015</i>
            </div>
            <div class="clearfix"></div>
            
            <div class="post">
  <article class="post-content">
    <p><a href='/docs/api-reference.html' title=''>‚Üê Back To API Reference</a>
<div class="api-code-section"><markdown></p>
            <h2>
                <a class="header-anchor"
                    name="promise.promisifyall"
                    aria-hidden="true"
                    href="#promise.promisifyall"><i class="fa fa-link"></i></a>
                Promise.promisifyAll
            </h2>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span>
    <span class="nb">Object</span> <span class="nx">target</span><span class="p">,</span>
    <span class="p">[</span><span class="nb">Object</span> <span class="p">{</span>
        <span class="nx">suffix</span><span class="o">:</span> <span class="nb">String</span><span class="o">=</span><span class="s2">&quot;Async&quot;</span><span class="p">,</span>
        <span class="nx">multiArgs</span><span class="o">:</span> <span class="kr">boolean</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span>
        <span class="nx">filter</span><span class="o">:</span> <span class="kr">boolean</span> <span class="kd">function</span><span class="p">(</span><span class="nb">String</span> <span class="nx">name</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">func</span><span class="p">,</span> <span class="nb">Object</span> <span class="nx">target</span><span class="p">,</span> <span class="kr">boolean</span> <span class="nx">passesDefaultFilter</span><span class="p">),</span>
        <span class="nx">promisifier</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="kd">function</span> <span class="nx">originalFunction</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">defaultPromisifier</span><span class="p">)</span>
    <span class="p">}</span> <span class="nx">options</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Object</span>
</code></pre></div>
<p>Promisifies the entire object by going through the object&#39;s properties and creating an async equivalent of each function on the object and its prototype chain. The promisified method name will be the original method name suffixed with <code>suffix</code> (default is <code>&quot;Async&quot;</code>). Any class properties of the object (which is the case for the main export of many modules) are also promisified, both static and instance methods. Class property is a property with a function value that has a non-empty <code>.prototype</code> object. Returns the input object.</p>

<p>Note that the original methods on the object are not overwritten but new methods are created with the <code>Async</code>-suffix. For example, if you <code>promisifyAll</code> the node.js <code>fs</code> object use <code>fs.statAsync</code> to call the promisified <code>stat</code> method.</p>

<p>Example:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;redis&quot;</span><span class="p">));</span>

<span class="c1">//Later on, all redis client instances have promise returning functions:</span>

<span class="nx">redisClient</span><span class="p">.</span><span class="nx">hexistsAsync</span><span class="p">(</span><span class="s2">&quot;myhash&quot;</span><span class="p">,</span> <span class="s2">&quot;field&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">});</span>
</code></pre></div>
<p>It also works on singletons or specific instances:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">));</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">readFileAsync</span><span class="p">(</span><span class="s2">&quot;myfile.js&quot;</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">contents</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">contents</span><span class="p">);</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>See <a href='#promisification' title=''>promisification</a> for more examples.</p>

<p>The entire prototype chain of the object is promisified on the object. Only enumerable are considered. If the object already has a promisified version of the method, it will be skipped. The target methods are assumed to conform to node.js callback convention of accepting a callback as last argument and calling that callback with error as the first argument and success value on the second argument. If the node method calls its callback with multiple success values, the fulfillment value will be an array of them.</p>

<p>If a method name already has an <code>&quot;Async&quot;</code>-suffix, it will be duplicated. E.g. <code>getAsync</code>&#39;s promisified name is <code>getAsyncAsync</code>.</p>
            <h4>
                <a class="header-anchor"
                    name="option-suffix"
                    aria-hidden="true"
                    href="#option-suffix"><i class="fa fa-link"></i></a>
                Option: suffix
            </h4>

<p>Optionally, you can define a custom suffix through the options object:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span> <span class="p">{</span><span class="nx">suffix</span><span class="o">:</span> <span class="s2">&quot;MySuffix&quot;</span><span class="p">});</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readFileMySuffix</span><span class="p">(...).</span><span class="nx">then</span><span class="p">(...);</span>
</code></pre></div>
<p>All the above limitations apply to custom suffices:</p>

<ul>
<li>Choose the suffix carefully, it must not collide with anything</li>
<li>PascalCase the suffix</li>
<li>The suffix must be a valid JavaScript identifier using ASCII letters</li>
<li>Always use the same suffix everywhere in your application, you could create a wrapper to make this easier:</li>
</ul>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">myPromisifyAll</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="p">{</span><span class="nx">suffix</span><span class="o">:</span> <span class="s2">&quot;MySuffix&quot;</span><span class="p">});</span>
<span class="p">};</span>
</code></pre></div>            <h4>
                <a class="header-anchor"
                    name="option-multiargs"
                    aria-hidden="true"
                    href="#option-multiargs"><i class="fa fa-link"></i></a>
                Option: multiArgs
            </h4>

<p>Setting <code>multiArgs</code> to <code>true</code> means the resulting promise will always fulfill with an array of the callback&#39;s success value(s). This is needed because promises only support a single success value while some callback API&#39;s have multiple success value. The default is to ignore all but the first success value of a callback function.</p>
            <h4>
                <a class="header-anchor"
                    name="option-filter"
                    aria-hidden="true"
                    href="#option-filter"><i class="fa fa-link"></i></a>
                Option: filter
            </h4>

<p>Optionally, you can define a custom filter through the options object:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(...,</span> <span class="p">{</span>
    <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">passesDefaultFilter</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// name = the property name to be promisified without suffix</span>
        <span class="c1">// func = the function</span>
        <span class="c1">// target = the target object where the promisified func will be put with name + suffix</span>
        <span class="c1">// passesDefaultFilter = whether the default filter would be passed</span>
        <span class="c1">// return boolean (return value is coerced, so not returning anything is same as returning false)</span>

        <span class="k">return</span> <span class="nx">passesDefaultFilter</span> <span class="o">&amp;&amp;</span> <span class="p">...</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>
<p>The default filter function will ignore properties that start with a leading underscore, properties that are not valid JavaScript identifiers and constructor functions (function which have enumerable properties in their <code>.prototype</code>).</p>
            <h4>
                <a class="header-anchor"
                    name="option-promisifier"
                    aria-hidden="true"
                    href="#option-promisifier"><i class="fa fa-link"></i></a>
                Option: promisifier
            </h4>

<p>Optionally, you can define a custom promisifier, so you could promisifyAll e.g. the chrome APIs used in Chrome extensions.</p>

<p>The promisifier gets a reference to the original method and should return a function which returns a promise.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">DOMPromisifier</span><span class="p">(</span><span class="nx">originalMethod</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// return a function</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">promisified</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
        <span class="c1">// Needed so that the original method can be called with the correct receiver</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="c1">// which returns a promise</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">);</span>
            <span class="nx">originalMethod</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Promisify e.g. chrome.browserAction</span>
<span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">,</span> <span class="p">{</span><span class="nx">promisifier</span><span class="o">:</span> <span class="nx">DOMPromisifier</span><span class="p">});</span>

<span class="c1">// Later</span>
<span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">getTitleAsync</span><span class="p">({</span><span class="nx">tabId</span><span class="o">:</span> <span class="mi">1</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">});</span>
</code></pre></div>
<p>Combining <code>filter</code> with <code>promisifier</code> for the restler module to promisify event emitter:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">Promise</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;bluebird&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">restler</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;restler&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">methodNamesToPromisify</span> <span class="o">=</span> <span class="s2">&quot;get post put del head patch json postJson putJson&quot;</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">EventEmitterPromisifier</span><span class="p">(</span><span class="nx">originalMethod</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// return a function</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">promisified</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
        <span class="c1">// Needed so that the original method can be called with the correct receiver</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="c1">// which returns a promise</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// We call the originalMethod here because if it throws,</span>
            <span class="c1">// it will reject the returned promise with the thrown error</span>
            <span class="kd">var</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="nx">originalMethod</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>

            <span class="nx">emitter</span>
                <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">resolve</span><span class="p">([</span><span class="nx">data</span><span class="p">,</span> <span class="nx">response</span><span class="p">]);</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Erroneous response like 400</span>
                    <span class="nx">resolve</span><span class="p">([</span><span class="nx">data</span><span class="p">,</span> <span class="nx">response</span><span class="p">]);</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;abort&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">CancellationError</span><span class="p">());</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">TimeoutError</span><span class="p">());</span>
                <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">restler</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">methodNamesToPromisify</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">promisifier</span><span class="o">:</span> <span class="nx">EventEmitterPromisifier</span>
<span class="p">});</span>

<span class="c1">// ...</span>

<span class="c1">// Later in some other file</span>

<span class="kd">var</span> <span class="nx">restler</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;restler&quot;</span><span class="p">);</span>
<span class="nx">restler</span><span class="p">.</span><span class="nx">getAsync</span><span class="p">(</span><span class="s2">&quot;http://...&quot;</span><span class="p">,</span> <span class="p">...,).</span><span class="nx">spread</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

<span class="p">})</span>
</code></pre></div>
<p>Using <code>defaultPromisifier</code> parameter to add enhancements on top of normal node
promisification:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">promisifier</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">originalFunction</span><span class="p">,</span> <span class="nx">defaultPromisifer</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">promisified</span> <span class="o">=</span> <span class="nx">defaultPromisifier</span><span class="p">(</span><span class="nx">originalFunction</span><span class="p">);</span>

        <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// Enhance normal promisification by supporting promises as</span>
            <span class="c1">// arguments</span>

            <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">args</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">awaitedArgs</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">promisified</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">awaitedArgs</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// All promisified fs functions now await their arguments if they are promises</span>
<span class="kd">var</span> <span class="nx">version</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileAsync</span><span class="p">(</span><span class="s2">&quot;package.json&quot;</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">);</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileAsync</span><span class="p">(</span><span class="s2">&quot;the-version.txt&quot;</span><span class="p">,</span> <span class="nx">version</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">);</span>
</code></pre></div>
<p></markdown></div></p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_title = "Promise.promisifyAll";
    var disqus_shortname = "bluebirdjs";
    var disqus_identifier = "disqus-id-promise.promisifyall";
    
    (function() {
        var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
        dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
        (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  </article>
</div>

        </div>
      </div>
    </div>
    <footer></footer>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
</body>

</html>
